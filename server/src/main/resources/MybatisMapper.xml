<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- resources/application.properties에 다음과 같이 추가해야 한다. -->
<!-- mybatis.mapper-locations=classpath:*.xml -->

<!-- namespace : Java 인터페이스 경로 -->
<mapper namespace="clickcloud.server.mybatis.MybatisMapper">
  <!-- id: 메서드 이름 -->
  <!-- parameterType: 파라미터의 자료형 -->
  <!-- resultType: 결과의 자료형 -->

  <!-- 1시간 이내 주요도시 100개의 날씨 정보 한번에 불러오기 -->
  <select id="getAllByTime" parameterType="long" resultType="clickcloud.server.dto.GlobalWeather">
    CALL getAllByTime(#{timestamp})
  </select>
  
  <!-- 특정 도시 이름을 파라미터로 받아 해당 도시 상세 날씨 정보 조회하기 -->
  <select id="searchName" parameterType="map" resultType="clickcloud.server.dto.LocalWeather">
    CALL SearchNameByTime(#{city_name}, #{timestamp})
  </select>

  <!-- cities 테이블에서 city_id 목록 가져오기 -->
  <select id="getCityId" resultType="java.util.List">
    SELECT city_id
    FROM cities
  </select>

  <!-- OpenWeatherMap으로부터 받아온 날씨 데이터 삽입하기 -->
  <insert id="insertWeather" parameterType="clickcloud.server.dto.Weather">
    INSERT INTO weather_2024 (
        weather_id, city_id, w_title, w_description,
        temp_now, temp_feels, temp_min, temp_max,
        pressure, humidity, wind_speed, wind_deg,
        rain_1h, snow_1h, cloud, sunrise, sunset, time_update
    )
    VALUES (
        #{weather_id}, #{city_id}, #{w_title}, #{w_description},
        #{temp_now}, #{temp_feels}, #{temp_min}, #{temp_max},
        #{pressure}, #{humidity}, #{wind_speed}, #{wind_deg},
        #{rain_1h}, #{snow_1h}, #{cloud}, #{sunrise}, #{sunset}, #{time_update}
    )
  </insert>

  <!-- TEST -->
  <select id="getTest" resultType="java.lang.String">
    SELECT COUNT(1) FROM weather_2024
  </select>
</mapper>